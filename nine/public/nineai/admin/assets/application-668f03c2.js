
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as Ie}from"./index-9f0acf5e.js";import{d as Ve,r as f,Q as F,B as J,x as Ae,o as r,c as w,e as l,f as t,R as x,S as C,b as u,j as ke,k as p,w as he,I as c,t as g,a as M,J as G,U as Te,V as h,W as Ue,E as T,h as d,X as xe,l as Ce,q as X}from"./index-534a2c19.js";import{u as Ge}from"./utcformatTime-e76e5157.js";import{A as De}from"./models-c1a48ae8.js";import{E as qe,A as Pe,Q as ze}from"./index-867b894d.js";const Se={style:{maxWidth:"350px"}},Ne={key:0,style:{maxHeight:"50px",cursor:"pointer"}},Me={key:1},Le={style:{maxWidth:"350px"}},$e={style:{maxHeight:"50px",cursor:"pointer"}},Be=["src"],Re={class:"flex justify-end mr-5"},je=Ve({__name:"application",setup(Fe){const O=f(),K=f(0),A=f(!1),D=f(!1),i=F({catId:"",modelTypeId:"",name:"",status:"",role:"",page:1,size:10}),Z=f("/api/upload/core"),L=f(),U=f(0),$=f(!1),W=f(0),q=f([]),s=F({catId:null,modelTypeId:null,name:null,preset:null,des:null,coverImg:null,demoData:null,order:100,status:0,isGpts:!1,gptsId:null}),E=F({catId:[{required:!0,message:"请选择App分类",trigger:"change"}],name:[{required:!0,message:"请填写App名称",trigger:"blur"}],preset:[{required:!0,message:"请填写App预设信息",trigger:"blur"}],gptsId:[{required:!0,message:"请填写Gpts的模型id",trigger:"blur"}],modelTypeId:[{required:!1,message:"请填写应用绑定的模型id",trigger:"change"}],isGpts:[{required:!0,message:"请选择应用类型",trigger:"change"}],des:[{required:!0,message:"请填写App描述",trigger:"blur"}],coverImg:[{required:!1,message:"请填写App封面图片地址",trigger:"blur"}],demoData:[{required:!1,message:"请填写App演示数据",trigger:"blur"}],order:[{required:!1,message:"请填写排序ID",trigger:"blur"}],status:[{required:!0,message:"请选择App状态",trigger:"change"}]}),Y=f([]),B=f([]),ee=J(()=>U.value?"更新应用":"新增应用"),le=J(()=>U.value?"确认更新":"确认新增");async function te(){try{const o=await De.queryModelType({size:1e3}),{rows:a}=o.data;q.value=a}catch{D.value=!1}}async function y(){try{D.value=!0;const o=await h.queryApp(i),{rows:a,count:b}=o.data;D.value=!1,K.value=b,Y.value=a.sort((k,v)=>v.order-k.order)}catch{D.value=!1}}async function ae(){const o=await h.queryCats({size:100}),{rows:a}=o.data;B.value=a}function oe(o){U.value=o.id,$.value=o.role==="user",W.value=o.status;const{name:a,status:b,des:k,order:v,coverImg:V,catId:n,preset:I,demoData:_,modelTypeId:P,isGpts:z,gptsId:S}=o;Ue(()=>{Object.assign(s,{name:a,status:b,des:k,order:v,coverImg:V,catId:n,preset:I,demoData:_,modelTypeId:P,isGpts:z,gptsId:S})}),A.value=!0}function se(o){U.value=0,o==null||o.resetFields()}async function re(o){await h.deleteApp({id:o.id}),T.success("删除分类成功"),y()}function de(o){o==null||o.resetFields(),y()}const ne=(o,a)=>{s.coverImg=o.data},ue=o=>{if(["image/png","image/jpeg","image/gif","image/webp"].includes(o.type)){if(o.size/1024>300)return T.error("当前限制文件最大不超过 300KB!"),!1}else return T.error("当前系统仅支持 PNG、JPEG、GIF、和 WebP 格式的图片!"),!1};function pe(o){o==null||o.validate(async a=>{if(a){if(U.value){const b={id:U.value,...s};$.value&&Object.assign(b,{status:W.value}),await h.updateApp(b),T({type:"success",message:"更新套餐成功！"})}else await h.createApp(s),T({type:"success",message:"创建新的套餐成功！"});A.value=!1,y()}})}async function ie(o){const a=await h.auditPassApp({id:o.id});T({type:"success",message:a.data}),y()}async function me(o){const a=await h.auditFailApp({id:o.id});T({type:"success",message:a.data}),y()}function ce(o){var a;return(a=q.value.find(b=>b.id===o))==null?void 0:a.modelName}return Ae(()=>{te(),y(),ae()}),(o,a)=>{const b=d("el-alert"),k=Ie,v=d("el-option"),V=d("el-select"),n=d("el-form-item"),I=d("el-input"),_=d("el-button"),P=d("Plus"),z=d("el-icon"),S=d("el-form"),m=d("el-table-column"),fe=d("el-image"),N=d("el-tag"),Q=d("el-tooltip"),R=d("el-popconfirm"),ge=d("el-table"),_e=d("el-pagination"),ye=d("el-row"),H=d("el-switch"),be=d("el-upload"),ve=d("el-dialog"),we=xe("loading");return r(),w("div",null,[l(k,null,{default:t(()=>[l(b,{closable:!1,"show-icon":"",title:"应用说明",description:"应用分为普通的预设和GPTS、具体使用参考官网！",type:"success"})]),_:1}),l(k,null,{default:t(()=>[l(S,{ref_key:"formRef",ref:O,inline:!0,model:i},{default:t(()=>[l(n,{label:"App分类",prop:"catId"},{default:t(()=>[l(V,{modelValue:i.catId,"onUpdate:modelValue":a[0]||(a[0]=e=>i.catId=e),placeholder:"请选择App分类",clearable:""},{default:t(()=>[(r(!0),w(x,null,C(u(B),e=>(r(),c(v,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"绑定模型",prop:"modelTypeId"},{default:t(()=>[l(V,{modelValue:i.modelTypeId,"onUpdate:modelValue":a[1]||(a[1]=e=>i.modelTypeId=e),placeholder:"请选绑定模型",clearable:""},{default:t(()=>[(r(!0),w(x,null,C(u(q),e=>(r(),c(v,{key:e.id,label:e.modelName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"App状态",prop:"status"},{default:t(()=>[l(V,{modelValue:i.status,"onUpdate:modelValue":a[2]||(a[2]=e=>i.status=e),placeholder:"请选择App状态",clearable:""},{default:t(()=>[(r(!0),w(x,null,C(u(qe),e=>(r(),c(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"App名称",prop:"name"},{default:t(()=>[l(I,{modelValue:i.name,"onUpdate:modelValue":a[3]||(a[3]=e=>i.name=e),placeholder:"App名称[模糊搜索]",clearable:"",onKeydown:ke(Ce(y,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])]),_:1}),l(n,{label:"App角色",prop:"status"},{default:t(()=>[l(V,{modelValue:i.role,"onUpdate:modelValue":a[4]||(a[4]=e=>i.role=e),placeholder:"请选择App角色",clearable:""},{default:t(()=>[(r(!0),w(x,null,C(u(Pe),e=>(r(),c(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(_,{type:"primary",onClick:y},{default:t(()=>[p(" 查询 ")]),_:1}),l(_,{onClick:a[5]||(a[5]=e=>de(u(O)))},{default:t(()=>[p(" 重置 ")]),_:1})]),_:1}),l(_,{type:"success",style:{float:"right"},onClick:a[6]||(a[6]=e=>A.value=!0)},{default:t(()=>[p(" 创建应用 "),l(z,{class:"ml-3"},{default:t(()=>[l(P)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(k,{style:{width:"100%"}},{default:t(()=>[he((r(),c(ge,{border:"",data:u(Y),style:{width:"100%"},size:"large"},{default:t(()=>[l(m,{prop:"id",label:"ID",width:"50"}),l(m,{prop:"coverImg",label:"应用封面",width:"100"},{default:t(e=>[l(fe,{style:{height:"50px"},src:e.row.coverImg,fit:"fill"},null,8,["src"])]),_:1}),l(m,{prop:"catName",label:"应用分类",width:"110"}),l(m,{prop:"name",label:"应用名称",width:"150"}),l(m,{prop:"status",label:"应用状态",width:"100"},{default:t(e=>[l(N,{type:[1,5].includes(e.row.status)?"success":"danger"},{default:t(()=>[p(g(u(ze)[e.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"public",label:"是否共享",width:"100"},{default:t(e=>[l(N,{type:e.row.public?"success":""},{default:t(()=>[p(g(e.row.public?"共享":"私有"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"public",label:"应用创建角色",width:"120"},{default:t(e=>[l(N,{type:e.row.role==="system"?"success":""},{default:t(()=>[p(g(e.row.role==="system"?"系统":"用户"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"public",label:"是否是Gpts",width:"120"},{default:t(e=>[l(N,{type:e.row.isGpts?"success":""},{default:t(()=>[p(g(e.row.isGpts?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"public",label:"绑定的模型",width:"200"},{default:t(e=>[p(g(ce(e.row.modelTypeId)||"暂未绑定"),1)]),_:1}),l(m,{prop:"public",label:"GptsId",width:"200"},{default:t(e=>[p(g(e.row.gptsId||"---"),1)]),_:1}),l(m,{prop:"order",label:"排序ID"}),p(" /> "),l(m,{prop:"preset",label:"预设信息",width:"400"},{default:t(e=>[l(Q,{class:"box-item",effect:"dark",placement:"top-start"},{content:t(()=>[M("div",Se,g(e.row.isGpts?"gpts应用暂无系统预设信息":e.row.preset),1)]),default:t(()=>[e.row.isGpts?(r(),w("div",Me," gpts应用暂无系统预设信息 ")):(r(),w("div",Ne,g(e.row.preset),1))]),_:2},1024)]),_:1}),l(m,{prop:"des",label:"描述信息",width:"300"},{default:t(e=>[l(Q,{class:"box-item",effect:"dark",placement:"top-start"},{content:t(()=>[M("div",Le,g(e.row.des),1)]),default:t(()=>[M("div",$e,g(e.row.des),1)]),_:2},1024)]),_:1}),l(m,{prop:"createdAt",label:"创建时间",width:"120"},{default:t(e=>[p(g(u(Ge)(e.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),l(m,{label:"操作",width:"200"},{default:t(e=>[l(_,{link:"",type:"primary",size:"small",onClick:j=>oe(e.row)},{default:t(()=>[p(" 编辑 ")]),_:2},1032,["onClick"]),l(R,{title:"确认删除此应用么?",width:"200","icon-color":"red",onConfirm:j=>re(e.row)},{reference:t(()=>[l(_,{link:"",type:"danger",size:"small"},{default:t(()=>[p(" 删除应用 ")]),_:1})]),_:2},1032,["onConfirm"]),e.row.role==="user"&&e.row.status===3?(r(),c(R,{key:0,title:"确认通过审核此应用么?",width:"200","icon-color":"red",onConfirm:j=>ie(e.row)},{reference:t(()=>[l(_,{link:"",type:"success",size:"small"},{default:t(()=>[p(" 通过审核 ")]),_:1})]),_:2},1032,["onConfirm"])):G("",!0),e.row.role==="user"&&e.row.status===3?(r(),c(R,{key:1,title:"确认拒绝通过此应用共享请求么?",width:"200","icon-color":"red",onConfirm:j=>me(e.row)},{reference:t(()=>[l(_,{link:"",type:"danger",size:"small"},{default:t(()=>[p(" 拒绝审核 ")]),_:1})]),_:2},1032,["onConfirm"])):G("",!0)]),_:1})]),_:1},8,["data"])),[[we,u(D)]]),l(ye,{class:"flex justify-end mt-5"},{default:t(()=>[l(_e,{"current-page":i.page,"onUpdate:currentPage":a[7]||(a[7]=e=>i.page=e),"page-size":i.size,"onUpdate:pageSize":a[8]||(a[8]=e=>i.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:u(K),onSizeChange:y,onCurrentChange:y},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(ve,{modelValue:u(A),"onUpdate:modelValue":a[21]||(a[21]=e=>Te(A)?A.value=e:null),"close-on-click-modal":!1,title:u(ee),width:"770",onClose:a[22]||(a[22]=e=>se(u(L)))},{footer:t(()=>[M("span",Re,[l(_,{onClick:a[19]||(a[19]=e=>A.value=!1)},{default:t(()=>[p("取消")]),_:1}),l(_,{type:"primary",onClick:a[20]||(a[20]=e=>pe(u(L)))},{default:t(()=>[p(g(u(le)),1)]),_:1})])]),default:t(()=>[l(S,{ref_key:"formPackageRef",ref:L,"label-position":"right","label-width":"100px",model:s,rules:E},{default:t(()=>[l(n,{label:"App分类",prop:"catId"},{default:t(()=>[l(V,{modelValue:s.catId,"onUpdate:modelValue":a[9]||(a[9]=e=>s.catId=e),placeholder:"请选择App分类",clearable:"",style:{width:"100%"}},{default:t(()=>[(r(!0),w(x,null,C(u(B),e=>(r(),c(v,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"是否是Gpts",prop:"isGpts"},{default:t(()=>[l(H,{modelValue:s.isGpts,"onUpdate:modelValue":a[10]||(a[10]=e=>s.isGpts=e)},null,8,["modelValue"])]),_:1}),s.isGpts?(r(),c(n,{key:0,label:"GptsId",prop:"gptsId"},{default:t(()=>[l(I,{modelValue:s.gptsId,"onUpdate:modelValue":a[11]||(a[11]=e=>s.gptsId=e),placeholder:"请填写Gpts的Id"},null,8,["modelValue"])]),_:1})):G("",!0),s.isGpts?G("",!0):(r(),c(n,{key:1,label:"绑定模型",prop:"modelTypeId"},{default:t(()=>[l(V,{modelValue:s.modelTypeId,"onUpdate:modelValue":a[12]||(a[12]=e=>s.modelTypeId=e),placeholder:"请选绑定模型",clearable:"",style:{width:"100%"}},{default:t(()=>[(r(!0),w(x,null,C(u(q),e=>(r(),c(v,{key:e.id,label:e.modelName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),l(n,{label:"应用名称",prop:"name"},{default:t(()=>[l(I,{modelValue:s.name,"onUpdate:modelValue":a[13]||(a[13]=e=>s.name=e),placeholder:"请填写App名称"},null,8,["modelValue"])]),_:1}),u($)?G("",!0):(r(),c(n,{key:2,label:"App状态",prop:"status"},{default:t(()=>[l(H,{modelValue:s.status,"onUpdate:modelValue":a[14]||(a[14]=e=>s.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})),s.isGpts?G("",!0):(r(),c(n,{key:3,label:"App预设",prop:"preset"},{default:t(()=>[l(I,{modelValue:s.preset,"onUpdate:modelValue":a[15]||(a[15]=e=>s.preset=e),type:"textarea",placeholder:"请填写App预设信息、用于给AI预设身份、系统预设信息、systemMessage...",rows:4},null,8,["modelValue"])]),_:1})),l(n,{label:"应用描述",prop:"des"},{default:t(()=>[l(I,{modelValue:s.des,"onUpdate:modelValue":a[16]||(a[16]=e=>s.des=e),type:"textarea",placeholder:"请填写App介绍信息、用于对外展示、告知用户当前应用的用途...",rows:4},null,8,["modelValue"])]),_:1}),l(n,{label:"示例内容",prop:"demoData"},{default:t(()=>[l(I,{modelValue:s.demoData,"onUpdate:modelValue":a[17]||(a[17]=e=>s.demoData=e),type:"textarea",placeholder:"请填写App的demo示例数据、每换行一次表示一个新的示例...",rows:4},null,8,["modelValue"])]),_:1}),l(n,{label:"应用Logo",prop:"coverImg"},{default:t(()=>[l(be,{class:"avatar-uploader",action:u(Z),"show-file-list":!1,"on-success":ne,"before-upload":ue},{default:t(()=>[s.coverImg?(r(),w("img",{key:0,src:s.coverImg,style:{width:"100px"},class:"avatar"},null,8,Be)):(r(),c(z,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[l(P)]),_:1}))]),_:1},8,["action"])]),_:1}),l(n,{label:"排序ID",prop:"order"},{default:t(()=>[l(I,{modelValue:s.order,"onUpdate:modelValue":a[18]||(a[18]=e=>s.order=e),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof X=="function"&&X(je);export{je as default};
