
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{J as k}from"./style-c8945402.js";import{d as K,y as L,B,Q as E,r as y,x as F,o as O,c as Q,e,f as l,a as f,k as c,b as h,E as g,a1 as A,h as s,q as V}from"./index-534a2c19.js";import{a as w}from"./config-d4b6423d.js";const J={class:"flex justify-between"},R=f("b",null,"MJ绘图参数配置",-1),T=f("h4",null,"绘图代理配置",-1),D={class:"flex items-center"},$={class:"flex items-center"},z=f("br",null,null,-1),G={class:"flex items-center"},H=K({__name:"index",setup(W){const N=L(),P=B(()=>N.settings.app.colorScheme),o=E({mjProxyUrl:"",mjSecretKey:"",mjImageProxy:"",mjUserLimit:"",mjNotifyUrl:"",mjNotice:""}),M=y({mjProxyUrl:[{required:!0,trigger:"blur",message:"请填写Midjourney代理地址"}],mjSecretKey:[{required:!0,trigger:"blur",message:"请填写Midjourney的秘钥信息"}],mjImageProxy:[{required:!1,trigger:"blur",message:"请填写Midjourney图片代理地址"}],mjUserLimit:[{required:!0,trigger:"blur",message:"请填写用户并发限制"}],mjNotifyUrl:[{required:!0,trigger:"blur",message:"请填写绘图结果通知地址"}]}),U=y();async function b(){const n=await w.queryConfig({keys:["mjSecretKey","mjImageProxy","mjUserLimit","mjProxyUrl","mjNotifyUrl","mjNotice"]});Object.assign(o,n.data)}function S(){var n;(n=U.value)==null||n.validate(async t=>{if(t){try{await w.setConfig({settings:C(o)}),g.success("变更配置信息成功")}catch{}b()}else g.error("请填写完整信息")})}function C(n){return Object.keys(n).map(t=>({configKey:t,configVal:n[t]}))}const I=y("/api/upload/file");async function q(n,t){const j=await Promise.all(Array.from(n).map(m=>new Promise(async(d,i)=>{var p,_,x;const u=new FormData;u.append("file",m);try{const a=await A.post(I.value,u,{headers:{"Content-Type":"multipart/form-data"}});(p=a==null?void 0:a.data)!=null&&p.data||g.error("图片上传失败、请检查您的配置信息！"),d(a.data.data)}catch(a){g.error(((x=(_=a==null?void 0:a.response)==null?void 0:_.data)==null?void 0:x.message)||"图片上传失败、请检查您的配置信息！"),i(a)}})));t(j.map(m=>m)),g({message:"图片上传成功！",type:"success"})}return F(()=>{b()}),(n,t)=>{const j=s("el-button"),m=s("el-input"),d=s("el-form-item"),i=s("el-col"),u=s("el-row"),p=s("QuestionFilled"),_=s("el-icon"),x=s("el-tooltip"),a=s("el-form"),v=s("el-card");return O(),Q("div",null,[e(v,{style:{margin:"20px"}},{header:l(()=>[f("div",J,[R,e(j,{class:"button",text:"",onClick:S},{default:l(()=>[c(" 保存设置 ")]),_:1})])]),default:l(()=>[T,e(a,{ref_key:"formRef",ref:U,rules:M.value,model:o,"label-width":"130px"},{default:l(()=>[e(u,null,{default:l(()=>[e(i,{xs:24,md:20,lg:15,xl:12},{default:l(()=>[e(d,{label:"Mj代理地址",prop:"mjProxyUrl"},{default:l(()=>[e(m,{modelValue:o.mjProxyUrl,"onUpdate:modelValue":t[0]||(t[0]=r=>o.mjProxyUrl=r),placeholder:"请填写Mj代理地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,null,{default:l(()=>[e(i,{xs:24,md:20,lg:15,xl:12},{default:l(()=>[e(d,{label:"Mj秘钥信息",prop:"mjSecretKey"},{default:l(()=>[e(m,{modelValue:o.mjSecretKey,"onUpdate:modelValue":t[1]||(t[1]=r=>o.mjSecretKey=r),placeholder:"请填写Mj秘钥信息",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),f("h4",D,[c(" 图片代理地址 "),e(x,{content:"Midjourney图片地址无法直接访问、请配置图片代理地址用于访问图片！",placement:"right"},{default:l(()=>[e(_,{class:"ml-3 cursor-pointer mt-1"},{default:l(()=>[e(p)]),_:1})]),_:1})]),e(u,null,{default:l(()=>[e(i,{xs:24,md:20,lg:15,xl:12},{default:l(()=>[e(d,{label:"Mj图片代理地址",prop:"mjImageProxy"},{default:l(()=>[e(m,{modelValue:o.mjImageProxy,"onUpdate:modelValue":t[2]||(t[2]=r=>o.mjImageProxy=r),placeholder:"请填写Mj图片代理地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),f("h4",$,[c(" 绘图基础配置 "),e(x,{placement:"right"},{content:l(()=>[c(" 并发限制数量用于限制一个用户队列中过多的任务、用于平均资源、设置为0表示不限制、设置为-1表示禁用此功能、暂停开放绘图、设置正数表示正常开启！"),z,c(" 绘图通知地址用于接收绘图完成通知、请填写前端域名即可、例如 https://www.xxxxx.com ")]),default:l(()=>[e(_,{class:"ml-3 cursor-pointer mt-1"},{default:l(()=>[e(p)]),_:1})]),_:1})]),e(u,null,{default:l(()=>[e(i,{xs:24,md:20,lg:15,xl:12},{default:l(()=>[e(d,{label:"用户并发限制",prop:"mjUserLimit"},{default:l(()=>[e(m,{modelValue:o.mjUserLimit,"onUpdate:modelValue":t[3]||(t[3]=r=>o.mjUserLimit=r),placeholder:"请填写用户并发限制",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,null,{default:l(()=>[e(i,{xs:24,md:20,lg:15,xl:12},{default:l(()=>[e(d,{label:"绘图通知地址",prop:"mjNotifyUrl"},{default:l(()=>[e(m,{modelValue:o.mjNotifyUrl,"onUpdate:modelValue":t[4]||(t[4]=r=>o.mjNotifyUrl=r),placeholder:"请填写例如用户端域名例如https://www.xxxxx.com 的通知地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),f("h4",G,[c(" 绘图模块公告（扣款提示） "),e(x,{placement:"top"},{content:l(()=>[c(" 我们在绘图版本为你提供了一块区域用于展示你的公告内容、你可以填写md、html、富文本的方式插入此公告、告知用于使用当前模块的价格！ ")]),default:l(()=>[e(_,{class:"ml-3 cursor-pointer mt-1"},{default:l(()=>[e(p)]),_:1})]),_:1})]),e(u,null,{default:l(()=>[e(i,{xs:24,md:20,lg:15,xl:12},{default:l(()=>[e(d,{label:"绘图公告信息",prop:"mjNotice"},{default:l(()=>[e(h(k),{modelValue:o.mjNotice,"onUpdate:modelValue":t[5]||(t[5]=r=>o.mjNotice=r),style:{"min-height":"300px"},theme:h(P),onOnUploadImg:q},null,8,["modelValue","theme"])]),_:1})]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1})])}}});typeof V=="function"&&V(H);export{H as default};
